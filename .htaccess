# =====================================================
# BRICKSTONE REALTY GROUP — .htaccess
# Apache config for WhoGoHost shared hosting
# =====================================================


# -----------------------------------------------
# HTTPS ENFORCEMENT
# Redirect all HTTP → HTTPS + www
# -----------------------------------------------
RewriteEngine On

# Redirect non-www to www
RewriteCond %{HTTP_HOST} ^brickstonerealtygroups\.com$ [NC]
RewriteRule ^(.*)$ https://www.brickstonerealtygroups.com/$1 [R=301,L]

# Redirect HTTP to HTTPS
RewriteCond %{HTTPS} off
RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]


# -----------------------------------------------
# SECURITY HEADERS
# -----------------------------------------------
<IfModule mod_headers.c>
  # Prevent clickjacking
  Header always set X-Frame-Options "DENY"

  # Prevent MIME sniffing
  Header always set X-Content-Type-Options "nosniff"

  # XSS Protection (legacy browsers)
  Header always set X-XSS-Protection "1; mode=block"

  # HSTS — force HTTPS for 1 year (enable after confirming HTTPS works)
  Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"

  # Referrer policy
  Header always set Referrer-Policy "strict-origin-when-cross-origin"

  # Permissions policy — disable unused APIs
  Header always set Permissions-Policy "camera=(), microphone=(), geolocation=(), payment=()"

  # Content Security Policy (server-side — overrides meta CSP)
  Header always set Content-Security-Policy "default-src 'self'; script-src 'self' https://cdn.tailwindcss.com 'unsafe-inline'; style-src 'self' https://fonts.googleapis.com 'unsafe-inline'; font-src 'self' https://fonts.gstatic.com; img-src 'self' data: https:; connect-src 'self'; frame-src 'none'; frame-ancestors 'none'; base-uri 'self'; form-action 'self';"

  # Remove server info headers
  Header unset Server
  Header unset X-Powered-By
</IfModule>


# -----------------------------------------------
# CUSTOM 404 PAGE
# -----------------------------------------------
ErrorDocument 404 /404.html


# -----------------------------------------------
# GZIP COMPRESSION
# Speeds up page load significantly
# -----------------------------------------------
<IfModule mod_deflate.c>
  AddOutputFilterByType DEFLATE text/html
  AddOutputFilterByType DEFLATE text/css
  AddOutputFilterByType DEFLATE text/javascript
  AddOutputFilterByType DEFLATE application/javascript
  AddOutputFilterByType DEFLATE application/x-javascript
  AddOutputFilterByType DEFLATE text/xml
  AddOutputFilterByType DEFLATE text/plain
  AddOutputFilterByType DEFLATE image/svg+xml
  AddOutputFilterByType DEFLATE application/json
  AddOutputFilterByType DEFLATE application/font-woff
  AddOutputFilterByType DEFLATE application/font-woff2
</IfModule>


# -----------------------------------------------
# BROWSER CACHING
# Sets smart cache durations per file type
# -----------------------------------------------
<IfModule mod_expires.c>
  ExpiresActive On

  # HTML — short cache (content changes)
  ExpiresByType text/html                  "access plus 1 hour"

  # CSS & JS — long cache (versioned by filename ideally)
  ExpiresByType text/css                   "access plus 1 month"
  ExpiresByType application/javascript     "access plus 1 month"
  ExpiresByType text/javascript            "access plus 1 month"

  # Images
  ExpiresByType image/png                  "access plus 6 months"
  ExpiresByType image/jpg                  "access plus 6 months"
  ExpiresByType image/jpeg                 "access plus 6 months"
  ExpiresByType image/gif                  "access plus 6 months"
  ExpiresByType image/svg+xml             "access plus 6 months"
  ExpiresByType image/webp                 "access plus 6 months"
  ExpiresByType image/x-icon              "access plus 1 year"

  # Fonts
  ExpiresByType font/woff                  "access plus 1 year"
  ExpiresByType font/woff2                 "access plus 1 year"
  ExpiresByType application/font-woff     "access plus 1 year"
  ExpiresByType application/font-woff2    "access plus 1 year"
</IfModule>


# -----------------------------------------------
# CACHE-CONTROL HEADERS
# -----------------------------------------------
<IfModule mod_headers.c>
  <FilesMatch "\.(css|js)$">
    Header set Cache-Control "public, max-age=2592000"
  </FilesMatch>
  <FilesMatch "\.(png|jpg|jpeg|gif|svg|webp|ico|woff|woff2)$">
    Header set Cache-Control "public, max-age=15552000"
  </FilesMatch>
  <FilesMatch "\.html$">
    Header set Cache-Control "public, max-age=3600"
  </FilesMatch>
</IfModule>


# -----------------------------------------------
# BLOCK SENSITIVE FILES
# -----------------------------------------------
<FilesMatch "(^\.htaccess|\.htpasswd|\.git|\.env|\.log|\.sh|composer\.json|package\.json)$">
  Order Allow,Deny
  Deny from all
</FilesMatch>

# Block directory browsing
Options -Indexes


# -----------------------------------------------
# MIME TYPES
# -----------------------------------------------
<IfModule mod_mime.c>
  AddType image/svg+xml        .svg .svgz
  AddType image/webp           .webp
  AddType font/woff            .woff
  AddType font/woff2           .woff2
  AddType application/javascript .js
</IfModule>


# -----------------------------------------------
# SITEMAP — hint to crawlers
# -----------------------------------------------
# robots.txt at root handles Sitemap: directive
# Sitemap itself is at /sitemap.xml


# -----------------------------------------------
# REMOVE www for canonical consistency
# (already handled above — www is canonical)
# -----------------------------------------------
